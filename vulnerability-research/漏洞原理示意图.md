# 漏洞原理示意图

## 1. draw.io

### 1.1 draw.io's library for container security

仓库 [container-security-draw.io](https://github.com/ssst0n3/container-security-draw.io/) 提供了一些预置的容器安全图形库。

使用方式可参考 draw.io 文档：
* [Blog - Use a custom shape library from the web](https://www.drawio.com/blog/public-custom-libraries)

### 1.2 动画插件

draw.io 提供了一些[官方插件](https://www.drawio.com/doc/faq/plugins), 其中包括一个动画插件 anim 。

可以使用该插件制作动画，制作完毕后在发布后的viewer url参数中添加 `p=anim` 可以播放动画。

## 2. 视频

### 2.1 布局

建议视频左侧为原理动画、右侧为实际exp执行效果。

制作顺序：
1. 先录制exp视频
2. 根据exp视频中各步骤执行的时间，设置原理动画播放时间，再录制原理动画的视频
3. 合并左右画面

### 2.2 视频录制

```shell
recordmydesktop --no-sound -x 0 -y 0 --width=1920 --height=1080
```

### 2.3 视频左右画面拼接

```shell
ffmpeg \
  -i left.ogv \
  -i right.ogv \
  -filter_complex "[0:v][1:v]hstack=inputs=2:shortest=1" \
  -c:v libx264 -crf 23 -pix_fmt yuv420p \
  -an \
  union.mp4
```

### 2.4 格式转换

ogv -> gif

```shell
ffmpeg -i out.ogv -vf "palettegen" palette.png
ffmpeg -i out.ogv -i palette.png -lavfi "fps=5 [x]; [x][1:v] paletteuse" out.gif
```

ogv -> mp4

```shell
ffmpeg -i nvc-ldcache-overwrite.ogv -an -c:v libx264 -pix_fmt yuv420p -crf 23 out.mp4
```

### 2.5 在 github markdown 中嵌入视频

github 暂不支持使用相对路径插入视频，但支持以附件的形式上传视频，直接将视频拖到github编辑界面即可。

例如：

https://github.com/JanahAleixo/lab-natty-or-not/blob/154407832268cf0e9b96942ab5b555c492fefad7/README.md#L48